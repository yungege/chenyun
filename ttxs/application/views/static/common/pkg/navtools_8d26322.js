define("common:widget/toolsbar/toolsbar.js",function(n,o){var t=n("common:widget/lib/jquery.js"),i=n("common:widget/dropmenu/dropmenu.js"),e=n("common:widget/login/login.js"),u={init:function(){this.initDropMenu(),this.getDom(),this.logoutEvent(),this.loginEvent()},loginEvent:function(){this.loginBtn.unbind().click(function(){new e.login})},getDom:function(){this.container=t(".toolsbar"),this.logoutBtn=this.container.find(".logout"),this.loginBtn=this.container.find(".login")},initDropMenu:function(){new i.dropmenu({picker:".user",showItem:".my-drop-menu"}),new i.dropmenu({picker:".msg-center",showItem:".msg-drop-menu"}),new i.dropmenu({picker:".mobile-terminal",showItem:".appdownload"}),new i.dropmenu({picker:".mobile-terminal-unlogin",showItem:".appdownload"})},logoutEvent:function(){this.logoutBtn.unbind().click(function(){t.getJSON("/home/interface/logout",function(n){0===n.status.code&&window.location.reload()})})}};o.toolsbar=u});
;define("common:widget/nav/nav.js",function(e,t){var i=e("common:widget/lib/jquery.js"),n=e("common:widget/dropmenu/dropmenu.js"),o={declare:function(){this.dropMenuTargetClass="nav-drop-target",this.dropMenuItemClass="nav-drop-item",this.isIndexPageClass="show-model-drop"},init:function(){this.declare(),this.getDom(),this.initDropMenu(),this.initThreeDropNav()},initThreeDropNav:function(){var e;return this.modelDropNavTarget.find(".first-level-item").each(function(){e=i(this),new n.dropmenu({picker:e,showItem:e.find(".second-level"),showTimeDelay:50})}),this.modelDropNavTarget.hasClass(this.isIndexPageClass)?!1:void new n.dropmenu({picker:this.modelDropNavTarget,showItem:".model-category"})},initDropMenu:function(){var e,t=this;this.navItem.each(function(){e=i(this),e.hasClass(t.dropMenuTargetClass)&&new n.dropmenu({picker:e,showItem:e.find("."+t.dropMenuItemClass)})})},getDom:function(){this.container=i(".nav"),this.navItem=this.container.find("li"),this.modelDropNavTarget=i(".model-drop-target")}};t.nav=o});
;define("common:widget/search/search.js",function(e,t){var s=e("common:widget/lib/jquery.js"),i=e("common:widget/dropmenu/dropmenu.js"),r={declare:function(){this.keyEnter=13,this.keyLeft=37,this.keyRight=39,this.keyUp=38,this.keyDown=40,this.albumType=2,this.modelType=1,this.designerType=3,this.albumClass="album",this.designerClass="designer",this.keyChoiceClass="current",this.searchTypeAttr="data-type",this.searchTypeSelectShowClass="show-search-select-type",this.searchTypeSelectItemActiveClass="current",this.movePos=-1,this.hasResult=!1,this.listQuery},init:function(){this.getDom(),this.declare(),this.keyEvent(),this.listenInput(),this.listenMoveEvent(),this.enterEvent(),this.searchBtnEvent(),this.hideQueryListEvent(),this.selectTypeEvent()},selectTypeEvent:function(){var e=this;new i.dropmenu({picker:this.searchTypeSelectBtn,showItem:this.searchTypeSelectItemWarp,effectTimeDelay:100,showEffect:"slideDown",hideEffect:"slideUp",showCallBack:function(){e.searchTypeSelectWarp.addClass(e.searchTypeSelectShowClass)},hideCallBack:function(){e.searchTypeSelectWarp.removeClass(e.searchTypeSelectShowClass)}}),this.searchTypeSelectItem.unbind().click(function(){var t=s(this);return t.attr(e.searchTypeAttr)===e.searchTypeSelectBtn.attr(e.searchTypeAttr)?!1:(e.searchTypeSelectBtn.attr(e.searchTypeAttr,t.attr(e.searchTypeAttr)).html(" "+t.html()+' <i class="select-arrow"></i>'),e.searchFormType.attr("value",t.attr(e.searchTypeAttr)),e.searchTypeSelectItem.removeClass(e.searchTypeSelectItemActiveClass),t.addClass(e.searchTypeSelectItemActiveClass),void e.searchTypeSelectItemWarp.hide())})},hideQueryListEvent:function(){var e=this,t=!1;this.searchQueryList.mouseenter(function(){t=!0}).mouseleave(function(){t=!1}),this.searchInput.on("blur",function(){t||(e.searchQueryList.hide(),s(window).unbind("keydown"),t=!1)})},searchBtnEvent:function(){var e=this;this.searchBtn.unbind().click(function(){e.formSubmit()})},enterEvent:function(){var e=this;this.searchQueryList.mouseenter(function(){e.listQuery&&(e.listQuery.removeClass(e.keyChoiceClass),e.movePos=-1)})},keyEvent:function(){var e=this;this.searchInput.on("focus",function(){s(window).on("keydown",function(t){t.keyCode===e.keyEnter?-1===e.movePos?e.formSubmit():e.listQuery.eq(e.movePos).find("a").each(function(){this.click()}):e.listenMoveEvent(t.keyCode)})})},listenMoveEvent:function(e){e===this.keyUp?this.moveUpEvent():e===this.keyDown&&this.moveDownEvent()},moveUpEvent:function(){return this.hasResult?(this.movePos-=1,this.movePos<0&&(this.movePos=this.listQuery.length-1),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},moveDownEvent:function(){return this.hasResult?(this.movePos+=1,this.movePos>this.listQuery.length-1&&(this.movePos=0),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},listenInput:function(){var e,t=this;this.searchInput.on("input",function(){return s(this).val()?(e&&e.abort(),void(e=s.getJSON("/home/interface/search?words="+t.searchInput.val()+"&type="+t.searchFormType.val(),function(e){t.render(e)}))):!1})},renderAlbum:function(e){var t='<li class="'+this.albumClass+'">';return t+='<a href="/album/'+e.cid+'.html">',t+='<img src="'+e.list_pic+'">',t+='<div class="context">',t+="<h4>"+this.truncate(e.name,16)+"<span>[专辑]</span></h4>",t+='<p class="author">'+e.nickname+"</p>",t+='<p class="summary">'+this.truncate(e.summary,22)+"</p>",t+="</p></a></li>"},truncate:function(e,t){return e?e.length<t?e:e.substring(0,t)+"……":""},renderModel:function(e){return'<li><a href="/model/'+e.cid+'.html">'+this.truncate(e.name,28)+"</a></li>"},renderDesigner:function(e){var t='<li class="'+this.designerClass+'">';return t+='<a href="/p/'+e.username+'.html">',t+='<img src="'+e.header_pic+'">',t+='<div class="context">',t+="<h4>"+e.nickname+"<span>[设计师]</span></h4>",t+="<p>粉丝<em>"+e.be_cared_count+"</em><i>模型</i><em>"+e.model_view_count+"</em></p>",t+="</p></a></li>"},render:function(e){if(e=e.data.list,0===e.length)return this.searchQueryList.hide(),this.hasResult=!1,!1;var t="",s="",i="";for(var r in e)switch(e[r].type){case this.albumType:i+=this.renderAlbum(e[r]);break;case this.modelType:t+=this.renderModel(e[r]);break;case this.designerType:s+=this.renderDesigner(e[r])}var h="<ul>"+i+s+t+"</ul>";this.searchQueryList.html(h).show(),this.movePos=-1,this.listQuery=this.searchQueryList.find("li"),this.hasResult=!0},formSubmit:function(){var e=this.searchInput.val();return e?(this.searchFormWords.attr("value",e),void this.searchForm.submit()):!1},getDom:function(){this.container=s(".main-search"),this.searchInput=this.container.find(".main-search-value"),this.searchBtn=this.container.find(".main-search-btn"),this.searchForm=this.container.find("form"),this.searchFormWords=this.searchForm.find(".search-words"),this.searchFormType=this.searchForm.find(".search-type"),this.searchTypeSelectWarp=this.container.find(".main-search-select-type"),this.searchTypeSelectBtn=this.searchTypeSelectWarp.find(".now-select-type"),this.searchTypeSelectItemWarp=this.searchTypeSelectWarp.find("ul"),this.searchTypeSelectItem=this.searchTypeSelectItemWarp.find("li"),this.searchQueryList=this.container.find(".main-search-reslut")}};t.search=r});
;define("common:widget/login/login.js",function(e,i){function t(){this.tpl=['<div class="login-dialog">','<div class="title">',"<h3>登录</h3>",'<span class="close"></span>',"</div>",'<div class="login-content">','<div class="login-form need-verify-code">','<div class="input-group top">','<div class="notice up">用户名或密码错误</div>','<label for="username" class="username-label icon"></label>','<input type="text" placeholder="手机号/邮箱" class="username">',"</div>",'<div class="input-group">','<label for="password" class="password-label icon"></label>','<input type="password" placeholder="密码" class="password">',"</div>",'<div class="verify-code">','<div class="notice ver">验证码错误</div>','<div class="verify-box">','<input type="text" class="code" placeholder="验证码">','<img src="/home/interface/getverifycode" class="verify-code-img">','<span class="refush-code">换一张</span>',"</div>","</div>",'<div class="line">','<i class="checkbox icon rember"></i>',"记住我",'<a href="/findpasswd.html">忘记密码</a>',"</div>",'<button class="login-btn">登 录</button>','<p>还没有账号？<a href="/register.html">立即注册</a></p>','<p class="third-login">其他登录方式：','<a href="/oauth2/auth.html?type=qq" title="使用QQ登录"><i class="icon qq-icon"></i></a>','<a href="/oauth2/auth.html?type=wechat" title="使用微信登录"><i class="icon wechat-icon"></i></a>','<a href="/oauth2/auth.html?type=weibo" title="使用微博登录"><i class="icon weibo-icon"></i></a>',"</p>","</div>",'<div class="scan">','<div class="scan-code code-loading">',"</div>",'<a href="/app.html">下载客户端</a>',"<p>扫一扫 自动登录</p>","</div>","</div>","</div>"].join(""),this.init()}var o=e("common:widget/dialog/dialog.js"),s=e("common:widget/checkbox/checkbox.js"),n=e("common:widget/lib/jquery.js"),a=e("common:widget/qrcode/qrcode.js"),c=e("common:widget/cookie/cookie.js"),r=e("common:widget/code/code.js");t.prototype={init:function(){this.createDialog(),this.getDom(),this.declare(),this.renderCode(),this.focusEvent(),this.blurEvent(),this.loginBtnEvent(),this.showVerifyCode(),this.refushCodeEvent(),this.listenEnter(),this.listenScan()},listenScan:function(){var e=this;this.timer=setInterval(function(){n.getJSON("/home/interface/checklogin",function(i){0===i.status.code&&(clearInterval(e.timer),window.location.reload())})},this.timeDelay),this.closeBtn.click(function(){clearInterval(e.timer)})},listenEnter:function(){var e=this;n(window).on("keydown",function(i){13===i.keyCode&&e.loginEvent()})},refushCodeEvent:function(){var e=this.verifyImg.attr("src"),i=this;this.verifyImgFlushBtn.unbind().click(function(){var t=+new Date;i.verifyImg.attr("src",e+"?t="+t)})},showVerifyCode:function(){this.needVerifyCode&&this.verifyWarp.slideDown()},setErrorTimes:function(){var e=new Date,i=e.getFullYear(),t=e.getMonth()+1,e=e.getDate()+1,o=new Date(i+"/"+t+"/"+e),s=void 0===c.cookie.get("p_et")?1:parseInt(c.cookie.get("p_et"),10)+1;c.cookie.set("p_et",s,{path:"/",domain:document.domain,expires:o})},loginBtnEvent:function(){var e=this;this.loginBtn.unbind().click(function(){e.loginEvent()})},loginEvent:function(){var e=this;return this.validate()?void(this.needVerifyCode?n.getJSON("/home/interface/verifycode?code="+e.verifyCode.val(),function(i){0===i.status.code?e.loginCoreEvent():e.verNotice.html(r.code[i.status.code]).addClass(e.noticeShowClass)}):this.loginCoreEvent()):!1},loginCoreEvent:function(){var e=this,i=this.checkStatus.getStatus("rember")?1:0;n.ajax({url:"/home/interface/login",type:"post",data:{username:this.username.val(),password:this.password.val(),autologin:i},success:function(i){0===i.status.code?window.location.reload():(e.setErrorTimes(),-10===i.status.code?e.verNotice.html(r.code[i.status.code]).addClass(e.noticeShowClass):e.upNotice.html(r.code[i.status.code]).addClass(e.noticeShowClass))}})},blurEvent:function(){var e=this;this.input.on("blur",function(){e.validate()})},validate:function(){var e=/^1\d{10}$/,i=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,t=/^\w{4}$/;return e.test(this.username.val())||i.test(this.username.val())?this.password.val().length<8?(this.upNotice.html("密码长度不符").addClass(this.noticeShowClass),!1):this.needVerifyCode&&!t.test(this.verifyCode.val())?(this.verNotice.html("验证码格式错误").addClass(this.noticeShowClass),!1):!0:(this.upNotice.html("账号格式不符").addClass(this.noticeShowClass),!1)},focusEvent:function(){var e=this;this.input.on("focus",function(){e.upNotice.removeClass(e.noticeShowClass),e.verNotice.removeClass(e.noticeShowClass)})},renderCode:function(){var e=window.domain+"/home/interface/scanlogin?sessid="+c.cookie.get("ck_dayinji");a.qrcode({picker:this.codeContainer,width:150,height:150,text:e})},declare:function(){this.errorCount=0,this.noticeShowClass="show",this.checkStatus=new s.checkbox(".rember"),this.needVerifyCode=void 0===c.cookie.get("p_et")||parseInt(c.cookie.get("p_et"),10)<3?!1:!0,this.timer=null,this.timeDelay=3e3},getDom:function(){this.container=n(".login-dialog"),this.username=this.container.find(".username"),this.password=this.container.find(".password"),this.loginBtn=this.container.find("button"),this.upNotice=this.container.find(".up"),this.verNotice=this.container.find(".ver"),this.verifyWarp=this.container.find(".verify-code"),this.verifyCode=this.container.find(".code"),this.verifyImg=this.container.find(".verify-code-img"),this.verifyImgFlushBtn=this.container.find(".refush-code"),this.input=this.container.find("input"),this.closeBtn=this.container.find(".close"),this.codeContainer=this.container.find(".scan-code")},createDialog:function(){this.dialog=new o.dialog({width:734,height:406,tpl:this.tpl,close:".login-dialog .close"})}},i.login=t});
;define("common:widget/topnav/topnav.js",function(e,t){var s=e("common:widget/lib/jquery.js"),i=e("common:widget/login/login.js"),n=e("common:widget/dropmenu/dropmenu.js"),r={declare:function(){this.keyEnter=13,this.keyLeft=37,this.keyRight=39,this.keyUp=38,this.keyDown=40,this.albumType=2,this.modelType=1,this.designerType=3,this.albumClass="album",this.designerClass="designer",this.keyChoiceClass="current",this.searchTypeAttr="data-type",this.searchTypeSelectShowClass="show-search-select-type",this.searchTypeSelectItemActiveClass="current",this.movePos=-1,this.hasResult=!1,this.listQuery},init:function(){this.getDom(),this.declare(),this.showEvent(),this.initDropMenu(),this.logoutEvent(),this.loginEvent(),this.keyEvent(),this.listenInput(),this.listenMoveEvent(),this.enterEvent(),this.hideQueryListEvent(),this.searchBtnEvent(),this.selectTypeEvent(),this.mobileDownloadEvent()},searchBtnEvent:function(){var e=this;this.searchBtn.unbind().click(function(){e.formSubmit()})},selectTypeEvent:function(){var e=this;new n.dropmenu({picker:this.searchTypeSelectBtn,showItem:this.searchTypeSelectItemWarp,effectTimeDelay:100,showEffect:"slideDown",hideEffect:"slideUp",showCallBack:function(){e.searchTypeSelectWarp.addClass(e.searchTypeSelectShowClass)},hideCallBack:function(){e.searchTypeSelectWarp.removeClass(e.searchTypeSelectShowClass)}}),this.searchTypeSelectItem.unbind().click(function(){var t=s(this);return t.attr(e.searchTypeAttr)===e.searchTypeSelectBtn.attr(e.searchTypeAttr)?!1:(e.searchTypeSelectBtn.attr(e.searchTypeAttr,t.attr(e.searchTypeAttr)).html(" "+t.html()+' <i class="select-arrow"></i>'),e.searchFormType.attr("value",t.attr(e.searchTypeAttr)),e.searchTypeSelectItem.removeClass(e.searchTypeSelectItemActiveClass),t.addClass(e.searchTypeSelectItemActiveClass),void e.searchTypeSelectItemWarp.hide())})},mobileDownloadEvent:function(){new n.dropmenu({picker:".topnav-mobile-sub",showItem:".app-download"}),new n.dropmenu({picker:".mobile-terminal-unlogin-sub",showItem:".app-download"})},loginEvent:function(){return this.loginBtn?void this.loginBtn.unbind().click(function(){return new i.login,!1}):!1},logoutEvent:function(){this.logoutBtn.unbind().click(function(){return s.getJSON("/home/interface/logout",function(e){0===e.status.code&&window.location.reload()}),!1})},initDropMenu:function(){new n.dropmenu({picker:".topnav-user",showItem:".topnav-my-drop-menu",showTimeDelay:240}),new n.dropmenu({picker:".topnav-msg-center",showItem:".topnav-msg-drop-menu",showTimeDelay:240})},showEvent:function(){var e=this,t=0;s(window).on("scroll",function(){t=parseInt(s(window).scrollTop(),10),t>173?e.container.is(":hidden")&&e.container.show():e.container.is(":visible")&&e.container.hide()})},hideQueryListEvent:function(){var e=this,t=!1;this.searchQueryList.mouseenter(function(){t=!0}).mouseleave(function(){t=!1}),this.searchInput.on("blur",function(){t||(e.searchQueryList.hide(),s(window).unbind("keydown"),t=!1)})},enterEvent:function(){var e=this;this.searchQueryList.mouseenter(function(){e.listQuery&&(e.listQuery.removeClass(e.keyChoiceClass),e.movePos=-1)})},keyEvent:function(){var e=this;this.searchInput.on("focus",function(){s(window).on("keydown",function(t){t.keyCode===e.keyEnter?-1===e.movePos?e.formSubmit():e.listQuery.eq(e.movePos).find("a").each(function(){this.click()}):e.listenMoveEvent(t.keyCode)})})},listenMoveEvent:function(e){e===this.keyUp?this.moveUpEvent():e===this.keyDown&&this.moveDownEvent()},moveUpEvent:function(){return this.hasResult?(this.movePos-=1,this.movePos<0&&(this.movePos=this.listQuery.length-1),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},moveDownEvent:function(){return this.hasResult?(this.movePos+=1,this.movePos>this.listQuery.length-1&&(this.movePos=0),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},listenInput:function(){var e,t=this;this.searchInput.on("input",function(){return s(this).val()?(e&&e.abort(),void(e=s.getJSON("/home/interface/search?words="+t.searchInput.val()+"&type="+t.searchFormType.val(),function(e){t.render(e)}))):!1})},renderAlbum:function(e){var t='<li class="'+this.albumClass+'">';return t+='<a href="/album/'+e.cid+'.html">',t+='<img src="'+e.list_pic+'">',t+='<div class="context">',t+="<h4>"+this.truncate(e.name,16)+"<span>[专辑]</span></h4>",t+='<p class="author">'+e.nickname+"</p>",t+='<p class="summary">'+this.truncate(e.summary,22)+"</p>",t+="</p></a></li>"},truncate:function(e,t){return e?e.length<t?e:e.substring(0,t)+"……":""},renderModel:function(e){return'<li><a href="/model/'+e.cid+'.html">'+this.truncate(e.name,28)+"</a></li>"},renderDesigner:function(e){var t='<li class="'+this.designerClass+'">';return t+='<a href="/p/'+e.username+'.html">',t+='<img src="'+e.header_pic+'">',t+='<div class="context">',t+="<h4>"+e.nickname+"<span>[设计师]</span></h4>",t+="<p>粉丝<em>"+e.be_cared_count+"</em><i>模型</i><em>"+e.model_view_count+"</em></p>",t+="</p></a></li>"},render:function(e){if(e=e.data.list,0===e.length)return this.searchQueryList.hide(),this.hasResult=!1,!1;var t="",s="",i="";for(var n in e)switch(e[n].type){case this.albumType:i+=this.renderAlbum(e[n]);break;case this.modelType:t+=this.renderModel(e[n]);break;case this.designerType:s+=this.renderDesigner(e[n])}var r="<ul>"+i+s+t+"</ul>";this.searchQueryList.html(r).show(),this.movePos=-1,this.listQuery=this.searchQueryList.find("li"),this.hasResult=!0},formSubmit:function(){var e=this.searchInput.val();return e?(this.searchFormWords.attr("value",e),void this.searchForm.submit()):!1},getDom:function(){this.container=s(".topnav"),this.logoutBtn=this.container.find(".topnav-logout"),this.loginBtn=this.container.find(".topnav-login"),this.searchInput=this.container.find(".topnav-search-value"),this.searchBtn=this.container.find(".topnav-search-icon"),this.searchForm=this.container.find("form"),this.searchFormWords=this.searchForm.find(".search-words"),this.searchFormType=this.searchForm.find(".search-type"),this.searchTypeSelectWarp=this.container.find(".topnav-search-select-type"),this.searchTypeSelectBtn=this.searchTypeSelectWarp.find(".now-select-type"),this.searchTypeSelectItemWarp=this.searchTypeSelectWarp.find("ul"),this.searchTypeSelectItem=this.searchTypeSelectItemWarp.find("li"),this.searchQueryList=this.container.find(".topnav-search-reslut")}};t.topnav=r});