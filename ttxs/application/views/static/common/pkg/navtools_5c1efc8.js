define("common:widget/toolsbar/toolsbar.js",function(n,o){var t=n("common:widget/lib/jquery.js"),i=n("common:widget/dropmenu/dropmenu.js"),e=n("common:widget/login/login.js"),u={init:function(){this.initDropMenu(),this.getDom(),this.logoutEvent(),this.loginEvent()},loginEvent:function(){this.loginBtn.unbind().click(function(){new e.login})},getDom:function(){this.container=t(".toolsbar"),this.logoutBtn=this.container.find(".logout"),this.loginBtn=this.container.find(".login")},initDropMenu:function(){new i.dropmenu({picker:".user",showItem:".my-drop-menu"}),new i.dropmenu({picker:".msg-center",showItem:".msg-drop-menu"})},logoutEvent:function(){this.logoutBtn.unbind().click(function(){t.getJSON("/home/interface/logout",function(n){0===n.status.code&&window.location.reload()})})}};o.toolsbar=u});
;define("common:widget/nav/nav.js",function(e,t){var i=e("common:widget/lib/jquery.js"),n=e("common:widget/dropmenu/dropmenu.js"),o={declare:function(){this.dropMenuTargetClass="nav-drop-target",this.dropMenuItemClass="nav-drop-item",this.isIndexPageClass="show-model-drop"},init:function(){this.declare(),this.getDom(),this.initDropMenu(),this.initThreeDropNav()},initThreeDropNav:function(){var e;return this.modelDropNavTarget.find(".first-level-item").each(function(){e=i(this),new n.dropmenu({picker:e,showItem:e.find(".second-level"),showTimeDelay:50})}),this.modelDropNavTarget.hasClass(this.isIndexPageClass)?!1:void new n.dropmenu({picker:this.modelDropNavTarget,showItem:".model-category"})},initDropMenu:function(){var e,t=this;this.navItem.each(function(){e=i(this),e.hasClass(t.dropMenuTargetClass)&&new n.dropmenu({picker:e,showItem:e.find("."+t.dropMenuItemClass)})})},getDom:function(){this.container=i(".nav"),this.navItem=this.container.find("li"),this.modelDropNavTarget=i(".model-drop-target")}};t.nav=o});
;define("common:widget/search/search.js",function(e,s){var t=e("common:widget/lib/jquery.js"),i={declare:function(){this.keyEnter=13,this.keyLeft=37,this.keyRight=39,this.keyUp=38,this.keyDown=40,this.albumType=2,this.modelType=1,this.designerType=3,this.albumClass="album",this.designerClass="designer",this.keyChoiceClass="current",this.movePos=-1,this.hasResult=!1,this.listQuery},init:function(){this.getDom(),this.declare(),this.keyEvent(),this.listenInput(),this.listenMoveEvent(),this.enterEvent(),this.searchBtnEvent(),this.hideQueryListEvent()},hideQueryListEvent:function(){var e=this,s=!1;this.searchQueryList.mouseenter(function(){s=!0}).mouseleave(function(){s=!1}),this.searchInput.on("blur",function(){s||(e.searchQueryList.hide(),t(window).unbind("keydown"),s=!1)})},searchBtnEvent:function(){var e=this;this.searchBtn.unbind().click(function(){e.formSubmit()})},enterEvent:function(){var e=this;this.searchQueryList.mouseenter(function(){e.listQuery&&(e.listQuery.removeClass(e.keyChoiceClass),e.movePos=-1)})},keyEvent:function(){var e=this;this.searchInput.on("focus",function(){t(window).on("keydown",function(s){s.keyCode===e.keyEnter?-1===e.movePos?e.formSubmit():e.listQuery.eq(e.movePos).find("a").each(function(){this.click()}):e.listenMoveEvent(s.keyCode)})})},listenMoveEvent:function(e){e===this.keyUp?this.moveUpEvent():e===this.keyDown&&this.moveDownEvent()},moveUpEvent:function(){return this.hasResult?(this.movePos-=1,this.movePos<0&&(this.movePos=this.listQuery.length-1),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},moveDownEvent:function(){return this.hasResult?(this.movePos+=1,this.movePos>this.listQuery.length-1&&(this.movePos=0),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},listenInput:function(){var e,s=this;this.searchInput.on("input",function(){return t(this).val()?(e&&e.abort(),void(e=t.getJSON("/home/interface/search?words="+s.searchInput.val(),function(e){s.render(e)}))):!1})},renderAlbum:function(e){var s='<li class="'+this.albumClass+'">';return s+='<a href="/album/'+e.cid+'.html">',s+='<img src="'+e.list_pic+'">',s+='<div class="context">',s+="<h4>"+this.truncate(e.name,16)+"<span>[专辑]</span></h4>",s+='<p class="author">'+e.nickname+"</p>",s+='<p class="summary">'+this.truncate(e.summary,22)+"</p>",s+="</p></a></li>"},truncate:function(e,s){return e?e.length<s?e:e.substring(0,s)+"……":""},renderModel:function(e){return'<li><a href="/model/'+e.cid+'.html">'+this.truncate(e.name,28)+"</a></li>"},renderDesigner:function(e){var s='<li class="'+this.designerClass+'">';return s+='<a href="/p/'+e.username+'.html">',s+='<img src="'+e.header_pic+'">',s+='<div class="context">',s+="<h4>"+e.nickname+"<span>[设计师]</span></h4>",s+="<p>粉丝<em>"+e.be_cared_count+"</em><i>模型</i><em>"+e.model_view_count+"</em></p>",s+="</p></a></li>"},render:function(e){if(e=e.data.list,0===e.length)return this.searchQueryList.hide(),this.hasResult=!1,!1;var s="",t="",i="";for(var n in e)switch(e[n].type){case this.albumType:i+=this.renderAlbum(e[n]);break;case this.modelType:s+=this.renderModel(e[n]);break;case this.designerType:t+=this.renderDesigner(e[n])}var h="<ul>"+i+t+s+"</ul>";this.searchQueryList.html(h).show(),this.movePos=-1,this.listQuery=this.searchQueryList.find("li"),this.hasResult=!0},formSubmit:function(){var e=this.searchInput.val();return e?(this.searchFormWords.attr("value",e),void this.searchForm.submit()):!1},getDom:function(){this.container=t(".main-search"),this.searchInput=this.container.find(".main-search-value"),this.searchBtn=this.container.find(".main-search-btn"),this.searchForm=this.container.find("form"),this.searchFormWords=this.searchForm.find("input"),this.searchQueryList=this.container.find(".main-search-reslut")}};s.search=i});
;define("common:widget/login/login.js",function(e,i){function t(){this.tpl=['<div class="login-dialog">','<div class="title">',"<h3>登录</h3>",'<span class="close"></span>',"</div>",'<div class="login-content">','<div class="login-form need-verify-code">','<div class="input-group top">','<div class="notice up">用户名或密码错误</div>','<label for="username" class="username-label icon"></label>','<input type="text" placeholder="手机号/邮箱" class="username">',"</div>",'<div class="input-group">','<label for="password" class="password-label icon"></label>','<input type="password" placeholder="密码" class="password">',"</div>",'<div class="verify-code">','<div class="notice ver">验证码错误</div>','<div class="verify-box">','<input type="text" class="code" placeholder="验证码">','<img src="/home/interface/getverifycode" class="verify-code-img">','<span class="refush-code">换一张</span>',"</div>","</div>",'<div class="line">','<i class="checkbox icon rember"></i>',"记住我",'<a href="/findpasswd.html">忘记密码</a>',"</div>",'<button class="login-btn">登 录</button>','<p>还没有账号？<a href="/register.html">立即注册</a></p>','<p class="third-login">其他登录方式：','<a href="/oauth2/auth.html?type=qq" title="使用QQ登录"><i class="icon qq-icon"></i></a>','<a href="/oauth2/auth.html?type=wechat" title="使用微信登录"><i class="icon wechat-icon"></i></a>','<a href="/oauth2/auth.html?type=weibo" title="使用微博登录"><i class="icon weibo-icon"></i></a>',"</p>","</div>",'<div class="scan">','<div class="scan-code code-loading">',"</div>",'<a href="/topic/app">下载客户端</a>',"<p>扫一扫 自动登录</p>","</div>","</div>","</div>"].join(""),this.init()}var o=e("common:widget/dialog/dialog.js"),s=e("common:widget/checkbox/checkbox.js"),n=e("common:widget/lib/jquery.js"),a=e("common:widget/qrcode/qrcode.js"),c=e("common:widget/cookie/cookie.js"),r=e("common:widget/code/code.js");t.prototype={init:function(){this.createDialog(),this.getDom(),this.declare(),this.renderCode(),this.focusEvent(),this.blurEvent(),this.loginBtnEvent(),this.showVerifyCode(),this.refushCodeEvent(),this.listenEnter(),this.listenScan()},listenScan:function(){var e=this;this.timer=setInterval(function(){n.getJSON("/home/interface/checklogin",function(i){0===i.status.code&&(clearInterval(e.timer),window.location.reload())})},this.timeDelay),this.closeBtn.click(function(){clearInterval(e.timer)})},listenEnter:function(){var e=this;n(window).on("keydown",function(i){13===i.keyCode&&e.loginEvent()})},refushCodeEvent:function(){var e=this.verifyImg.attr("src"),i=this;this.verifyImgFlushBtn.unbind().click(function(){var t=+new Date;i.verifyImg.attr("src",e+"?t="+t)})},showVerifyCode:function(){this.needVerifyCode&&this.verifyWarp.slideDown()},setErrorTimes:function(){var e=new Date,i=e.getFullYear(),t=e.getMonth()+1,e=e.getDate()+1,o=new Date(i+"/"+t+"/"+e),s=void 0===c.cookie.get("p_et")?1:parseInt(c.cookie.get("p_et"),10)+1;c.cookie.set("p_et",s,{path:"/",domain:document.domain,expires:o})},loginBtnEvent:function(){var e=this;this.loginBtn.unbind().click(function(){e.loginEvent()})},loginEvent:function(){var e=this;return this.validate()?void(this.needVerifyCode?n.getJSON("/home/interface/verifycode?code="+e.verifyCode.val(),function(i){0===i.status.code?e.loginCoreEvent():e.verNotice.html(r.code[i.status.code]).addClass(e.noticeShowClass)}):this.loginCoreEvent()):!1},loginCoreEvent:function(){var e=this,i=this.checkStatus.getStatus("rember")?1:0;n.ajax({url:"/home/interface/login",type:"post",data:{username:this.username.val(),password:this.password.val(),autologin:i},success:function(i){0===i.status.code?window.location.reload():(e.setErrorTimes(),-10===i.status.code?e.verNotice.html(r.code[i.status.code]).addClass(e.noticeShowClass):e.upNotice.html(r.code[i.status.code]).addClass(e.noticeShowClass))}})},blurEvent:function(){var e=this;this.input.on("blur",function(){e.validate()})},validate:function(){var e=/^1\d{10}$/,i=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(.[a-zA-Z0-9_-])+/,t=/^\w{4}$/;return e.test(this.username.val())||i.test(this.username.val())?this.password.val().length<8?(this.upNotice.html("密码长度不符").addClass(this.noticeShowClass),!1):this.needVerifyCode&&!t.test(this.verifyCode.val())?(this.verNotice.html("验证码格式错误").addClass(this.noticeShowClass),!1):!0:(this.upNotice.html("账号格式不符").addClass(this.noticeShowClass),!1)},focusEvent:function(){var e=this;this.input.on("focus",function(){e.upNotice.removeClass(e.noticeShowClass),e.verNotice.removeClass(e.noticeShowClass)})},renderCode:function(){var e=window.domain+"/home/interface/scanlogin?sessid="+c.cookie.get("PHPSESSID");a.qrcode({picker:this.codeContainer,width:150,height:150,text:e})},declare:function(){this.errorCount=0,this.noticeShowClass="show",this.checkStatus=new s.checkbox(".rember"),this.needVerifyCode=void 0===c.cookie.get("p_et")||parseInt(c.cookie.get("p_et"),10)<3?!1:!0,this.timer=null,this.timeDelay=3e3},getDom:function(){this.container=n(".login-dialog"),this.username=this.container.find(".username"),this.password=this.container.find(".password"),this.loginBtn=this.container.find("button"),this.upNotice=this.container.find(".up"),this.verNotice=this.container.find(".ver"),this.verifyWarp=this.container.find(".verify-code"),this.verifyCode=this.container.find(".code"),this.verifyImg=this.container.find(".verify-code-img"),this.verifyImgFlushBtn=this.container.find(".refush-code"),this.input=this.container.find("input"),this.closeBtn=this.container.find(".close"),this.codeContainer=this.container.find(".scan-code")},createDialog:function(){this.dialog=new o.dialog({width:734,height:406,tpl:this.tpl,close:".login-dialog .close"})}},i.login=t});
;define("common:widget/topnav/topnav.js",function(t,e){var i=t("common:widget/lib/jquery.js"),s=t("common:widget/login/login.js"),n=t("common:widget/dropmenu/dropmenu.js"),o={declare:function(){this.keyEnter=13,this.keyLeft=37,this.keyRight=39,this.keyUp=38,this.keyDown=40,this.albumType=2,this.modelType=1,this.designerType=3,this.albumClass="album",this.designerClass="designer",this.keyChoiceClass="current",this.movePos=-1,this.hasResult=!1,this.listQuery},init:function(){this.getDom(),this.declare(),this.showEvent(),this.initDropMenu(),this.logoutEvent(),this.loginEvent(),this.keyEvent(),this.listenInput(),this.listenMoveEvent(),this.enterEvent(),this.hideQueryListEvent()},loginEvent:function(){return this.loginBtn?void this.loginBtn.unbind().click(function(){return new s.login,!1}):!1},logoutEvent:function(){this.logoutBtn.unbind().click(function(){return i.getJSON("/home/interface/logout",function(t){0===t.status.code&&window.location.reload()}),!1})},initDropMenu:function(){new n.dropmenu({picker:".topnav-user",showItem:".topnav-my-drop-menu",showTimeDelay:240}),new n.dropmenu({picker:".topnav-msg-center",showItem:".topnav-msg-drop-menu",showTimeDelay:240})},showEvent:function(){var t=this,e=0;i(window).on("scroll",function(){e=parseInt(i(window).scrollTop(),10),e>173?t.container.is(":hidden")&&t.container.show():t.container.is(":visible")&&t.container.hide()})},hideQueryListEvent:function(){var t=this,e=!1;this.searchQueryList.mouseenter(function(){e=!0}).mouseleave(function(){e=!1}),this.searchInput.on("blur",function(){e||(t.searchQueryList.hide(),i(window).unbind("keydown"),e=!1)})},enterEvent:function(){var t=this;this.searchQueryList.mouseenter(function(){t.listQuery&&(t.listQuery.removeClass(t.keyChoiceClass),t.movePos=-1)})},keyEvent:function(){var t=this;this.searchInput.on("focus",function(){i(window).on("keydown",function(e){e.keyCode===t.keyEnter?-1===t.movePos?t.formSubmit():t.listQuery.eq(t.movePos).find("a").each(function(){this.click()}):t.listenMoveEvent(e.keyCode)})})},listenMoveEvent:function(t){t===this.keyUp?this.moveUpEvent():t===this.keyDown&&this.moveDownEvent()},moveUpEvent:function(){return this.hasResult?(this.movePos-=1,this.movePos<0&&(this.movePos=this.listQuery.length-1),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},moveDownEvent:function(){return this.hasResult?(this.movePos+=1,this.movePos>this.listQuery.length-1&&(this.movePos=0),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},listenInput:function(){var t,e=this;this.searchInput.on("input",function(){return i(this).val()?(t&&t.abort(),void(t=i.getJSON("/home/interface/search?words="+e.searchInput.val(),function(t){e.render(t)}))):!1})},renderAlbum:function(t){var e='<li class="'+this.albumClass+'">';return e+='<a href="/album/'+t.cid+'.html">',e+='<img src="'+t.list_pic+'">',e+='<div class="context">',e+="<h4>"+this.truncate(t.name,16)+"<span>[专辑]</span></h4>",e+='<p class="author">'+t.nickname+"</p>",e+='<p class="summary">'+this.truncate(t.summary,22)+"</p>",e+="</p></a></li>"},truncate:function(t,e){return t?t.length<e?t:t.substring(0,e)+"……":""},renderModel:function(t){return'<li><a href="/model/'+t.cid+'.html">'+this.truncate(t.name,28)+"</a></li>"},renderDesigner:function(t){var e='<li class="'+this.designerClass+'">';return e+='<a href="/p/'+t.username+'.html">',e+='<img src="'+t.header_pic+'">',e+='<div class="context">',e+="<h4>"+t.nickname+"<span>[设计师]</span></h4>",e+="<p>粉丝<em>"+t.be_cared_count+"</em><i>模型</i><em>"+t.model_view_count+"</em></p>",e+="</p></a></li>"},render:function(t){if(t=t.data.list,0===t.length)return this.searchQueryList.hide(),this.hasResult=!1,!1;var e="",i="",s="";for(var n in t)switch(t[n].type){case this.albumType:s+=this.renderAlbum(t[n]);break;case this.modelType:e+=this.renderModel(t[n]);break;case this.designerType:i+=this.renderDesigner(t[n])}var o="<ul>"+s+i+e+"</ul>";this.searchQueryList.html(o).show(),this.movePos=-1,this.listQuery=this.searchQueryList.find("li"),this.hasResult=!0},formSubmit:function(){var t=this.searchInput.val();return t?(this.searchFormWords.attr("value",t),void this.searchForm.submit()):!1},getDom:function(){this.container=i(".topnav"),this.logoutBtn=this.container.find(".topnav-logout"),this.loginBtn=this.container.find(".topnav-login"),this.searchInput=this.container.find(".topnav-search-value"),this.searchForm=this.container.find("form"),this.searchFormWords=this.searchForm.find("input"),this.searchQueryList=this.container.find(".topnav-search-reslut")}};e.topnav=o});