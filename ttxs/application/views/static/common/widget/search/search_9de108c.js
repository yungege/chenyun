define("common:widget/search/search.js",function(e,t){var s=e("common:widget/lib/jquery.js"),i=e("common:widget/dropmenu/dropmenu.js"),r={declare:function(){this.keyEnter=13,this.keyLeft=37,this.keyRight=39,this.keyUp=38,this.keyDown=40,this.albumType=2,this.modelType=1,this.designerType=3,this.albumClass="album",this.designerClass="designer",this.keyChoiceClass="current",this.searchTypeAttr="data-type",this.searchTypeSelectShowClass="show-search-select-type",this.searchTypeSelectItemActiveClass="current",this.movePos=-1,this.hasResult=!1,this.listQuery},init:function(){this.getDom(),this.declare(),this.keyEvent(),this.listenInput(),this.listenMoveEvent(),this.enterEvent(),this.searchBtnEvent(),this.hideQueryListEvent(),this.selectTypeEvent()},selectTypeEvent:function(){var e=this;new i.dropmenu({picker:this.searchTypeSelectBtn,showItem:this.searchTypeSelectItemWarp,effectTimeDelay:100,showEffect:"slideDown",hideEffect:"slideUp",showCallBack:function(){e.searchTypeSelectWarp.addClass(e.searchTypeSelectShowClass)},hideCallBack:function(){e.searchTypeSelectWarp.removeClass(e.searchTypeSelectShowClass)}}),this.searchTypeSelectItem.unbind().click(function(){var t=s(this);return t.attr(e.searchTypeAttr)===e.searchTypeSelectBtn.attr(e.searchTypeAttr)?!1:(e.searchTypeSelectBtn.attr(e.searchTypeAttr,t.attr(e.searchTypeAttr)).html(" "+t.html()+' <i class="select-arrow"></i>'),e.searchFormType.attr("value",t.attr(e.searchTypeAttr)),e.searchTypeSelectItem.removeClass(e.searchTypeSelectItemActiveClass),t.addClass(e.searchTypeSelectItemActiveClass),void e.searchTypeSelectItemWarp.hide())})},hideQueryListEvent:function(){var e=this,t=!1;this.searchQueryList.mouseenter(function(){t=!0}).mouseleave(function(){t=!1}),this.searchInput.on("blur",function(){t||(e.searchQueryList.hide(),s(window).unbind("keydown"),t=!1)})},searchBtnEvent:function(){var e=this;this.searchBtn.unbind().click(function(){e.formSubmit()})},enterEvent:function(){var e=this;this.searchQueryList.mouseenter(function(){e.listQuery&&(e.listQuery.removeClass(e.keyChoiceClass),e.movePos=-1)})},keyEvent:function(){var e=this;this.searchInput.on("focus",function(){s(window).on("keydown",function(t){t.keyCode===e.keyEnter?-1===e.movePos?e.formSubmit():e.listQuery.eq(e.movePos).find("a").each(function(){this.click()}):e.listenMoveEvent(t.keyCode)})})},listenMoveEvent:function(e){e===this.keyUp?this.moveUpEvent():e===this.keyDown&&this.moveDownEvent()},moveUpEvent:function(){return this.hasResult?(this.movePos-=1,this.movePos<0&&(this.movePos=this.listQuery.length-1),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},moveDownEvent:function(){return this.hasResult?(this.movePos+=1,this.movePos>this.listQuery.length-1&&(this.movePos=0),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},listenInput:function(){var e,t=this;this.searchInput.on("input",function(){return s(this).val()?(e&&e.abort(),void(e=s.getJSON("/home/interface/search?words="+t.searchInput.val()+"&type="+t.searchFormType.val(),function(e){t.render(e)}))):!1})},renderAlbum:function(e){var t='<li class="'+this.albumClass+'">';return t+='<a href="/album/'+e.cid+'.html">',t+='<img src="'+e.list_pic+'">',t+='<div class="context">',t+="<h4>"+this.truncate(e.name,16)+"<span>[专辑]</span></h4>",t+='<p class="author">'+e.nickname+"</p>",t+='<p class="summary">'+this.truncate(e.summary,22)+"</p>",t+="</p></a></li>"},truncate:function(e,t){return e?e.length<t?e:e.substring(0,t)+"……":""},renderModel:function(e){return'<li><a href="/model/'+e.cid+'.html">'+this.truncate(e.name,28)+"</a></li>"},renderDesigner:function(e){var t='<li class="'+this.designerClass+'">';return t+='<a href="/p/'+e.username+'.html">',t+='<img src="'+e.header_pic+'">',t+='<div class="context">',t+="<h4>"+e.nickname+"<span>[设计师]</span></h4>",t+="<p>粉丝<em>"+e.be_cared_count+"</em><i>模型</i><em>"+e.model_view_count+"</em></p>",t+="</p></a></li>"},render:function(e){if(e=e.data.list,0===e.length)return this.searchQueryList.hide(),this.hasResult=!1,!1;var t="",s="",i="";for(var r in e)switch(e[r].type){case this.albumType:i+=this.renderAlbum(e[r]);break;case this.modelType:t+=this.renderModel(e[r]);break;case this.designerType:s+=this.renderDesigner(e[r])}var h="<ul>"+i+s+t+"</ul>";this.searchQueryList.html(h).show(),this.movePos=-1,this.listQuery=this.searchQueryList.find("li"),this.hasResult=!0},formSubmit:function(){var e=this.searchInput.val();return e?(this.searchFormWords.attr("value",e),void this.searchForm.submit()):!1},getDom:function(){this.container=s(".main-search"),this.searchInput=this.container.find(".main-search-value"),this.searchBtn=this.container.find(".main-search-btn"),this.searchForm=this.container.find("form"),this.searchFormWords=this.searchForm.find(".search-words"),this.searchFormType=this.searchForm.find(".search-type"),this.searchTypeSelectWarp=this.container.find(".main-search-select-type"),this.searchTypeSelectBtn=this.searchTypeSelectWarp.find(".now-select-type"),this.searchTypeSelectItemWarp=this.searchTypeSelectWarp.find("ul"),this.searchTypeSelectItem=this.searchTypeSelectItemWarp.find("li"),this.searchQueryList=this.container.find(".main-search-reslut")}};t.search=r});