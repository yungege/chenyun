define("common:widget/view/parsestl.js",function(e,t){var r=e("common:widget/lib/three.js"),n=e("common:widget/view/support.js"),o={parse:function(e){var t=function(){var e,t,o,i;if(n.indexOf("solid")>-1&&n.indexOf("facet")>-1&&n.indexOf("endfacet")>-1)return!1;if(i=new DataView(r),t=50,o=i.getUint32(80,!0),e=84+o*t,(i.byteLength-84)/50===0)return!0;for(var a=i.byteLength,s=0;a>s;s++)if(i.getUint8(s,!1)>127)return!0;return!1},r=this.ensureBinary(e),n=this.ensureString(e);return t()?this.parseBinary(r):this.parseASCII(n)},parseBinary:function(e){for(var t,n,o,i,a,s,u,h,f,c=new DataView(e),p=c.getUint32(80,!0),d=84,l=50,g=0,w=new r.THREE.Geometry,E=[],v=0;p>v;v++){var E=[];f=d+v*l,o=c.getFloat32(f,!0),i=c.getFloat32(f+4,!0),a=c.getFloat32(f+8,!0);for(var _=1;3>=_;_++){var y=f+12*_;s=c.getFloat32(y,!0),u=c.getFloat32(y+4,!0),h=c.getFloat32(y+8,!0),E.push(s,u,h),w.vertices.push(new r.THREE.Vector3(s,u,h)),g+=3}if(0==o&&0==i&&0==a){var F,B,b,I,m,S,T=0,H=0,R=0;_=0,F=E[_+3]-E[_],B=E[_+4]-E[_+1],b=E[_+5]-E[_+2],I=E[_+6]-E[_],m=E[_+7]-E[_+1],S=E[_+8]-E[_+2],T=S*B-m*b,H=F*S-I*b,R=F*m-I*B,o=T,i=H,a=R}n=new r.THREE.Vector3(o,i,a),t=w.vertices.length,w.faces.push(new r.THREE.Face3(t-3,t-2,t-1,n))}return w},parseASCII:function(e){var t,n,o,i,a,s,u,h;for(t=new r.THREE.Geometry,i=/facet([\s\S]*?)endfacet/g;null!==(u=i.exec(e));){for(h=u[0],a=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!==(u=a.exec(h));)o=new r.THREE.Vector3(parseFloat(u[1]),parseFloat(u[3]),parseFloat(u[5]));for(s=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!==(u=s.exec(h));)t.vertices.push(new r.THREE.Vector3(parseFloat(u[1]),parseFloat(u[3]),parseFloat(u[5])));n=t.vertices.length,t.faces.push(new r.THREE.Face3(n-3,n-2,n-1,o))}return t.computeBoundingBox(),t.computeBoundingSphere(),t},ensureString:function(e){if("string"!=typeof e){for(var t=new Uint8Array(e),r="",n=0;n<e.byteLength;n++)r+=String.fromCharCode(t[n]);return r}return e},ensureBinary:function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}},i=function(e){this._buffer=e,this._pos=0};i.prototype={readInt8:function(){return this._decodeInt(8,!0)},readUInt8:function(){return this._decodeInt(8,!1)},readInt16:function(){return this._decodeInt(16,!0)},readUInt16:function(){return this._decodeInt(16,!1)},readInt32:function(){return this._decodeInt(32,!0)},readUInt32:function(){return this._decodeInt(32,!1)},readFloat:function(){return this._decodeFloat(23,8)},readDouble:function(){return this._decodeFloat(52,11)},readChar:function(){return this.readString(1)},readString:function(e){this._checkSize(8*e);var t=this._buffer.substr(this._pos,e);return this._pos+=e,t},seek:function(e){this._pos=e,this._checkSize(0)},getPosition:function(){return this._pos},getSize:function(){return this._buffer.length},_decodeFloat:function(e,t){var r=e+t+1,n=r>>3;this._checkSize(r);var o=Math.pow(2,t-1)-1,i=this._readBits(e+t,1,n),a=this._readBits(e,t,n),s=0,u=2,h=0;do for(var f=this._readByte(++h,n),c=e%8||8,p=1<<c;p>>=1;)f&p&&(s+=1/u),u*=2;while(e-=c);return this._pos+=n,a==(o<<1)+1?s?0/0:i?-1/0:+1/0:(1+-2*i)*(a||s?a?Math.pow(2,a-o)*(1+s):Math.pow(2,-o+1)*s:0)},_decodeInt:function(e,t){var r=this._readBits(0,e,e/8),n=Math.pow(2,e),o=t&&r>=n/2?r-n:r;return this._pos+=e/8,o},_shl:function(e,t){for(++t;--t;e=1073741824==(1073741824&(e%=2147483648))?2*e:2*(e-1073741824)+2147483647+1);return e},_readByte:function(e,t){return 255&this._buffer.charCodeAt(this._pos+t-e-1)},_readBits:function(e,t,r){var n=(e+t)%8,o=e%8,i=r-(e>>3)-1,a=r+(-(e+t)>>3),s=i-a,u=this._readByte(i,r)>>o&(1<<(s?8-o:t))-1;for(s&&n&&(u+=(this._readByte(a++,r)&(1<<n)-1)<<(s--<<3)-o);s;)u+=this._shl(this._readByte(a++,r),(s--<<3)-o);return u},_checkSize:function(e){if(!(this._pos+Math.ceil(e/8)<this._buffer.length))throw new Error("Index out of bound")}};var a={parse:function(e){var t=function(e){return e.indexOf("facet")>-1?!1:!0};return t(e)?this.parseBinary(e):this.parseASCII(e)},parseBinary:function(e){var t,n,o,a=0,s=new r.THREE.Geometry,u=new i(e);for(u.seek(80),t=u.readUInt32(),a=0;t>a;a++){var h=[u.readFloat(),u.readFloat(),u.readFloat()],f=[u.readFloat(),u.readFloat(),u.readFloat()],c=[u.readFloat(),u.readFloat(),u.readFloat()],p=[u.readFloat(),u.readFloat(),u.readFloat()],d=function(){if(0!=h[0]&&0!=h[1]&&0!=h[2])return h;var e,t,r,n,o,i,a=[],s=0,u=0,d=0;return e=c[0]-f[0],t=c[1]-f[1],r=c[2]-f[2],n=p[0]-f[0],o=p[1]-f[1],i=p[2]-f[2],s=i*t-o*r,u=e*i-n*r,d=e*o-n*t,a.push(s),a.push(u),a.push(d),a};h=d(),o=new r.THREE.Vector3(h[0],h[1],h[2]),s.vertices.push(new r.THREE.Vector3(f[0],f[1],f[2])),s.vertices.push(new r.THREE.Vector3(c[0],c[1],c[2])),s.vertices.push(new r.THREE.Vector3(p[0],p[1],p[2])),u.readUInt16(),n=s.vertices.length,s.faces.push(new r.THREE.Face3(n-3,n-2,n-1,o))}return s.computeBoundingBox(),s.computeBoundingSphere(),s},parseASCII:function(e){var t,n,o,i,a,s,u,h;for(t=new r.THREE.Geometry,i=/facet([\s\S]*?)endfacet/g;null!=(u=i.exec(e));){for(h=u[0],a=/normal[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!=(u=a.exec(h));)o=new r.THREE.Vector3(parseFloat(u[1]),parseFloat(u[3]),parseFloat(u[5]));for(s=/vertex[\s]+([\-+]?[0-9]+\.?[0-9]*([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+[\s]+([\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?)+/g;null!=(u=s.exec(h));)t.vertices.push(new r.THREE.Vector3(parseFloat(u[1]),parseFloat(u[3]),parseFloat(u[5])));n=t.vertices.length,t.faces.push(new r.THREE.Face3(n-3,n-2,n-1,o))}return t.computeBoundingBox(),t.computeBoundingSphere(),t}},s={parse:function(e){return n.support.checkXhr2()?(console.log("parse stl use arraybuffer"),o.parse(e)):(console.log("parse stl use text/plain"),a.parse(e))}};"undefined"==typeof DataView&&(DataView=function(e,t,r){this.buffer=e,this.byteOffset=t||0,this.byteLength=r||e.byteLength||e.length,this._isString="string"==typeof e},DataView.prototype={_getCharCodes:function(e,t,r){t=t||0,r=r||e.length;for(var n=t+r,o=[],i=t;n>i;i++)o.push(255&e.charCodeAt(i));return o},_getBytes:function(e,t,r){var n;if(void 0===r&&(r=this._littleEndian),t=void 0===t?this.byteOffset:this.byteOffset+t,void 0===e&&(e=this.byteLength-t),"number"!=typeof t)throw new TypeError("DataView byteOffset is not a number");if(0>e||t+e>this.byteLength)throw new Error("DataView length or (byteOffset+length) value is out of bounds");return n=this.isString?this._getCharCodes(this.buffer,t,t+e):this.buffer.slice(t,t+e),!r&&e>1&&(Array.isArray(n)===!1&&(n=Array.prototype.slice.call(n)),n.reverse()),n},getFloat64:function(e,t){var r=this._getBytes(8,e,t),n=1-2*(r[7]>>7),o=((r[7]<<1&255)<<3|r[6]>>4)-1023,i=(15&r[6])*Math.pow(2,48)+r[5]*Math.pow(2,40)+r[4]*Math.pow(2,32)+r[3]*Math.pow(2,24)+r[2]*Math.pow(2,16)+r[1]*Math.pow(2,8)+r[0];return 1024===o?0!==i?0/0:1/0*n:-1023===o?n*i*Math.pow(2,-1074):n*(1+i*Math.pow(2,-52))*Math.pow(2,o)},getFloat32:function(e,t){var r=this._getBytes(4,e,t),n=1-2*(r[3]>>7),o=(r[3]<<1&255|r[2]>>7)-127,i=(127&r[2])<<16|r[1]<<8|r[0];return 128===o?0!==i?0/0:1/0*n:-127===o?n*i*Math.pow(2,-149):n*(1+i*Math.pow(2,-23))*Math.pow(2,o)},getInt32:function(e,t){var r=this._getBytes(4,e,t);return r[3]<<24|r[2]<<16|r[1]<<8|r[0]},getUint32:function(e,t){return this.getInt32(e,t)>>>0},getInt16:function(e,t){return this.getUint16(e,t)<<16>>16},getUint16:function(e,t){var r=this._getBytes(2,e,t);return r[1]<<8|r[0]},getInt8:function(e){return this.getUint8(e)<<24>>24},getUint8:function(e){return this._getBytes(1,e)[0]}}),t.parsestl=s});