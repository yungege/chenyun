define("common:widget/topnav/topnav.js",function(t,e){var i=t("common:widget/lib/jquery.js"),s=t("common:widget/login/login.js"),n=t("common:widget/dropmenu/dropmenu.js"),o={declare:function(){this.keyEnter=13,this.keyLeft=37,this.keyRight=39,this.keyUp=38,this.keyDown=40,this.albumType=2,this.modelType=1,this.designerType=3,this.albumClass="album",this.designerClass="designer",this.keyChoiceClass="current",this.movePos=-1,this.hasResult=!1,this.listQuery},init:function(){this.getDom(),this.declare(),this.showEvent(),this.initDropMenu(),this.logoutEvent(),this.loginEvent(),this.keyEvent(),this.listenInput(),this.listenMoveEvent(),this.enterEvent(),this.hideQueryListEvent()},loginEvent:function(){return this.loginBtn?void this.loginBtn.unbind().click(function(){return new s.login,!1}):!1},logoutEvent:function(){this.logoutBtn.unbind().click(function(){return i.getJSON("/home/interface/logout",function(t){0===t.status.code&&window.location.reload()}),!1})},initDropMenu:function(){new n.dropmenu({picker:".topnav-user",showItem:".topnav-my-drop-menu",showTimeDelay:240}),new n.dropmenu({picker:".topnav-msg-center",showItem:".topnav-msg-drop-menu",showTimeDelay:240})},showEvent:function(){var t=this,e=0;i(window).on("scroll",function(){e=parseInt(i(window).scrollTop(),10),e>173?t.container.is(":hidden")&&t.container.show():t.container.is(":visible")&&t.container.hide()})},hideQueryListEvent:function(){var t=this,e=!1;this.searchQueryList.mouseenter(function(){e=!0}).mouseleave(function(){e=!1}),this.searchInput.on("blur",function(){e||(t.searchQueryList.hide(),i(window).unbind("keydown"),e=!1)})},enterEvent:function(){var t=this;this.searchQueryList.mouseenter(function(){t.listQuery&&(t.listQuery.removeClass(t.keyChoiceClass),t.movePos=-1)})},keyEvent:function(){var t=this;this.searchInput.on("focus",function(){i(window).on("keydown",function(e){e.keyCode===t.keyEnter?-1===t.movePos?t.formSubmit():t.listQuery.eq(t.movePos).find("a").each(function(){this.click()}):t.listenMoveEvent(e.keyCode)})})},listenMoveEvent:function(t){t===this.keyUp?this.moveUpEvent():t===this.keyDown&&this.moveDownEvent()},moveUpEvent:function(){return this.hasResult?(this.movePos-=1,this.movePos<0&&(this.movePos=this.listQuery.length-1),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},moveDownEvent:function(){return this.hasResult?(this.movePos+=1,this.movePos>this.listQuery.length-1&&(this.movePos=0),this.listQuery.removeClass(this.keyChoiceClass),void this.listQuery.eq(this.movePos).addClass(this.keyChoiceClass)):!1},listenInput:function(){var t,e=this;this.searchInput.on("input",function(){return i(this).val()?(t&&t.abort(),void(t=i.getJSON("/home/interface/search?words="+e.searchInput.val(),function(t){e.render(t)}))):!1})},renderAlbum:function(t){var e='<li class="'+this.albumClass+'">';return e+='<a href="/album/'+t.cid+'.html">',e+='<img src="'+t.list_pic+'">',e+='<div class="context">',e+="<h4>"+this.truncate(t.name,16)+"<span>[专辑]</span></h4>",e+='<p class="author">'+t.nickname+"</p>",e+='<p class="summary">'+this.truncate(t.summary,22)+"</p>",e+="</p></a></li>"},truncate:function(t,e){return t?t.length<e?t:t.substring(0,e)+"……":""},renderModel:function(t){return'<li><a href="/model/'+t.cid+'.html">'+this.truncate(t.name,28)+"</a></li>"},renderDesigner:function(t){var e='<li class="'+this.designerClass+'">';return e+='<a href="/p/'+t.username+'.html">',e+='<img src="'+t.header_pic+'">',e+='<div class="context">',e+="<h4>"+t.nickname+"<span>[设计师]</span></h4>",e+="<p>粉丝<em>"+t.be_cared_count+"</em><i>模型</i><em>"+t.model_view_count+"</em></p>",e+="</p></a></li>"},render:function(t){if(t=t.data.list,0===t.length)return this.searchQueryList.hide(),this.hasResult=!1,!1;var e="",i="",s="";for(var n in t)switch(t[n].type){case this.albumType:s+=this.renderAlbum(t[n]);break;case this.modelType:e+=this.renderModel(t[n]);break;case this.designerType:i+=this.renderDesigner(t[n])}var o="<ul>"+s+i+e+"</ul>";this.searchQueryList.html(o).show(),this.movePos=-1,this.listQuery=this.searchQueryList.find("li"),this.hasResult=!0},formSubmit:function(){var t=this.searchInput.val();return t?(this.searchFormWords.attr("value",t),void this.searchForm.submit()):!1},getDom:function(){this.container=i(".topnav"),this.logoutBtn=this.container.find(".topnav-logout"),this.loginBtn=this.container.find(".topnav-login"),this.searchInput=this.container.find(".topnav-search-value"),this.searchForm=this.container.find("form"),this.searchFormWords=this.searchForm.find("input"),this.searchQueryList=this.container.find(".topnav-search-reslut")}};e.topnav=o});